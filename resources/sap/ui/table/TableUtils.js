/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ui/core/library","sap/ui/core/theming/Parameters","sap/ui/model/ChangeReason","./TableGrouping","./TableColumnUtils","./TableMenuUtils","./TableBindingUtils","./library","sap/base/Log","sap/ui/thirdparty/jquery"],function(B,C,R,c,T,a,b,d,e,f,l,L,q){"use strict";var S=l.SelectionBehavior;var g=l.SelectionMode;var M=c.MessageType;var r;var h=null;var j={DATACELL:1,COLUMNHEADER:2,ROWHEADER:4,ROWACTION:8,COLUMNROWHEADER:16};j.ANYCONTENTCELL=j.ROWHEADER|j.DATACELL|j.ROWACTION;j.ANYCOLUMNHEADER=j.COLUMNHEADER|j.COLUMNROWHEADER;j.ANYROWHEADER=j.ROWHEADER|j.COLUMNROWHEADER;j.ANY=j.ANYCONTENTCELL|j.ANYCOLUMNHEADER;var m={sapUiSizeCozy:48,sapUiSizeCompact:32,sapUiSizeCondensed:24,undefined:32};var k=1;var n=1;var D={sapUiSizeCozy:m.sapUiSizeCozy+n,sapUiSizeCompact:m.sapUiSizeCompact+n,sapUiSizeCondensed:m.sapUiSizeCondensed+n,undefined:m.undefined+n};var o={Render:"Render",VerticalScroll:"VerticalScroll",FirstVisibleRowChange:"FirstVisibleRowChange",Unbind:"Unbind",Animation:"Animation",Resize:"Resize",Unknown:"Unknown"};for(var p in a){o[p]=a[p];}var I=":sapTabbable, .sapUiTableTreeIcon:not(.sapUiTableTreeIconLeaf)";var s={Grouping:b,Column:d,Menu:e,Binding:f,CELLTYPE:j,BaseSize:m,BaseBorderWidth:k,RowHorizontalFrameSize:n,DefaultRowHeight:D,RowsUpdateReason:o,INTERACTIVE_ELEMENT_SELECTORS:I,hasRowHeader:function(t){return(t.getSelectionMode()!==g.None&&t.getSelectionBehavior()!==S.RowOnly)||b.isGroupMode(t);},hasSelectAll:function(t){var i=t?t.getSelectionMode():g.None;return i===g.MultiToggle&&t.getEnableSelectAll();},hasRowHighlights:function(t){if(!t){return false;}var i=t.getRowSettingsTemplate();if(!i){return false;}var H=i.getHighlight();return i.isBound("highlight")||(H!=null&&H!==M.None);},getRowActionCount:function(t){var i=t.getRowActionTemplate();return i?i._getCount():0;},hasRowActions:function(t){var i=t.getRowActionTemplate();return i!=null&&(i.isBound("visible")||i.getVisible())&&s.getRowActionCount(t)>0;},isRowSelectionAllowed:function(t){return t.getSelectionMode()!==g.None&&(t.getSelectionBehavior()===S.Row||t.getSelectionBehavior()===S.RowOnly);},isRowSelectorSelectionAllowed:function(t){return t.getSelectionMode()!==g.None&&s.hasRowHeader(t);},areAllRowsSelected:function(t){if(!t){return false;}var i=t._getSelectableRowCount();return i>0&&i===t._getSelectedIndicesCount();},isNoDataVisible:function(t){if(!t.getShowNoData()){return false;}return!s.hasData(t);},hasData:function(t){var i=t.getBinding("rows");var u=t._getTotalRowCount();var H=u>0;if(i&&i.providesGrandTotal){var v=i.providesGrandTotal()&&i.hasTotaledMeasures();H=(v&&u>1)||(!v&&u>0);}return H;},isBusyIndicatorVisible:function(t){if(!t||!t.getDomRef()){return false;}return t.getDomRef().querySelector(".sapUiTableCnt > .sapUiLocalBusyIndicator")!=null;},hasPendingRequests:function(t){if(!t){return false;}if(s.canUsePendingRequestsCounter(t)){return t._iPendingRequests>0;}else{return t._bPendingRequest;}},canUsePendingRequestsCounter:function(t){var i=t?t.getBinding("rows"):null;if(s.isA(i,"sap.ui.model.analytics.AnalyticalBinding")){return i.bUseBatchRequests;}else if(s.isA(i,"sap.ui.model.TreeBinding")){return false;}return true;},isA:function(O,t){return B.isA(O,t);},toggleRowSelection:function(t,v,i,u){if(!t||!t.getBinding("rows")||t.getSelectionMode()===g.None||v==null){return false;}function w(A){if(!t._isRowSelectable(A)){return false;}t._iSourceRowIndex=A;var z=false;if(u){z=u(A,i);}else if(t.isIndexSelected(A)){if(i!==true){z=true;t.removeSelectionInterval(A,A);}}else if(i!==false){z=true;t.addSelectionInterval(A,A);}delete t._iSourceRowIndex;return z;}if(typeof v==="number"){if(v<0||v>=t._getTotalRowCount()){return false;}return w(v);}else{var $=q(v);var x=s.getCellInfo($[0]);var y=s.isRowSelectionAllowed(t);if(!s.Grouping.isInGroupingRow($[0])&&((x.isOfType(s.CELLTYPE.DATACELL|s.CELLTYPE.ROWACTION)&&y)||(x.isOfType(s.CELLTYPE.ROWHEADER)&&s.isRowSelectorSelectionAllowed(t)))){var A;if(x.isOfType(s.CELLTYPE.DATACELL)){A=t.getRows()[parseInt($.closest("tr",t.getDomRef()).attr("data-sap-ui-rowindex"))].getIndex();}else{A=t.getRows()[parseInt($.attr("data-sap-ui-rowindex"))].getIndex();}return w(A);}return false;}},getNoDataText:function(t){var N=t.getNoData();if(N instanceof C){return null;}else if(typeof N==="string"||t.getNoData()instanceof String){return N;}else{return s.getResourceText("TBL_NO_DATA");}},getVisibleColumnCount:function(t){return t._getVisibleColumns().length;},getHeaderRowCount:function(t){if(t._iHeaderRowCount===undefined){if(!t.getColumnHeaderVisible()){t._iHeaderRowCount=0;}else{var H=1;var u=t.getColumns();for(var i=0;i<u.length;i++){if(u[i].shouldRender()){H=Math.max(H,u[i].getMultiLabels().length);}}t._iHeaderRowCount=H;}}return t._iHeaderRowCount;},isVariableRowHeightEnabled:function(t){return t&&t._bVariableRowHeightEnabled&&t.getFixedRowCount()<=0&&t.getFixedBottomRowCount()<=0;},getTotalRowCount:function(t,i){var u=t._getTotalRowCount();if(i){u=Math.max(u,t.getVisibleRowCount());}return u;},getNonEmptyVisibleRowCount:function(t){return Math.min(t.getVisibleRowCount(),t._getTotalRowCount());},getFocusedItemInfo:function(t){var i=t._getItemNavigation();if(!i){return null;}return{cell:i.getFocusedIndex(),columnCount:i.iColumns,cellInRow:i.getFocusedIndex()%i.iColumns,row:Math.floor(i.getFocusedIndex()/i.iColumns),cellCount:i.getItemDomRefs().length,domRef:i.getFocusedDomRef()};},getRowIndexOfFocusedCell:function(t){var i=s.getFocusedItemInfo(t);return i.row-s.getHeaderRowCount(t);},isFixedColumn:function(t,i){return i<t.getComputedFixedColumnCount();},hasFixedColumns:function(t){return t.getComputedFixedColumnCount()>0;},focusItem:function(t,i,E){var u=t._getItemNavigation();if(u){u.focusItem(i,E);}},getCellInfo:function(i){var t;var $=q(i);var u;var v;var w;var x;var y;t={type:0,cell:null,rowIndex:null,columnIndex:null,columnSpan:null};if($.hasClass("sapUiTableDataCell")){u=$.data("sap-ui-colid");v=sap.ui.getCore().byId(u);t.type=s.CELLTYPE.DATACELL;t.rowIndex=parseInt($.parent().data("sap-ui-rowindex"));t.columnIndex=v.getIndex();t.columnSpan=1;}else if($.hasClass("sapUiTableHeaderDataCell")){w=/_([\d]+)/;u=$.attr("id");x=w.exec(u);y=x&&x[1]!=null?parseInt(x[1]):0;t.type=s.CELLTYPE.COLUMNHEADER;t.rowIndex=y;t.columnIndex=parseInt($.data("sap-ui-colindex"));t.columnSpan=parseInt($.attr("colspan")||1);}else if($.hasClass("sapUiTableRowSelectionCell")){t.type=s.CELLTYPE.ROWHEADER;t.rowIndex=parseInt($.data("sap-ui-rowindex"));t.columnIndex=-1;t.columnSpan=1;}else if($.hasClass("sapUiTableRowActionCell")){t.type=s.CELLTYPE.ROWACTION;t.rowIndex=parseInt($.data("sap-ui-rowindex"));t.columnIndex=-2;t.columnSpan=1;}else if($.hasClass("sapUiTableRowSelectionHeaderCell")){t.type=s.CELLTYPE.COLUMNROWHEADER;t.columnIndex=-1;t.columnSpan=1;}if(t.type!==0){t.cell=$;}t.isOfType=function(z){if(z==null){return false;}return(this.type&z)>0;};return t;},getRowColCell:function(t,u,v,w){var x=u>=0&&u<t.getRows().length?t.getRows()[u]:null;var y=w?t.getColumns():t._getVisibleColumns();var z=v>=0&&v<y.length?y[v]:null;var A=null;if(x&&z){if(w){if(z.shouldRender()){var V=t._getVisibleColumns();for(var i=0;i<V.length;i++){if(V[i]===z){A=x.getCells()[i];break;}}}}else{A=x.getCells()[v];}if(A&&A.data("sap-ui-colid")!=z.getId()){var E=x.getCells();for(var i=0;i<E.length;i++){if(E[i].data("sap-ui-colid")===z.getId()){A=E[i];break;}}}}return{row:x,column:z,cell:A};},getCell:function(t,E){if(!t||!E){return null;}var $=q(E);var i=t.getDomRef();var u=$.closest(".sapUiTableCell",i);if(u.length>0){return u;}return null;},getParentCell:function(t,E){var $=q(E);var i=s.getCell(t,E);if(!i||i[0]===$[0]){return null;}else{return i;}},registerResizeHandler:function(t,i,H,u){var v;if(typeof i=="string"){v=t.getDomRef(i);}else{L.error("sIdSuffix must be a string",t);return;}if(typeof H!=="function"){L.error("fnHandler must be a function",t);return;}s.deregisterResizeHandler(t,i);if(!t._mResizeHandlerIds){t._mResizeHandlerIds={};}if(u&&v){v=v.parentNode;}if(v){t._mResizeHandlerIds[i]=R.register(v,H);}return t._mResizeHandlerIds[i];},deregisterResizeHandler:function(t,v){var u;if(!t._mResizeHandlerIds){return;}if(typeof v=="string"){u=[v];}else if(v===undefined){u=[];for(var K in t._mResizeHandlerIds){if(typeof K=="string"&&t._mResizeHandlerIds.hasOwnProperty(K)){u.push(K);}}}else if(Array.isArray(v)){u=v;}for(var i=0;i<u.length;i++){var w=u[i];if(t._mResizeHandlerIds[w]){R.deregister(t._mResizeHandlerIds[w]);t._mResizeHandlerIds[w]=undefined;}}},isFirstScrollableRow:function(t,i){if(isNaN(i)){var $=q(i);i=parseInt($.add($.parent()).filter("[data-sap-ui-rowindex]").data("sap-ui-rowindex"));}var F=t.getFixedRowCount()||0;return i==F;},isLastScrollableRow:function(t,i){if(isNaN(i)){var $=q(i);i=parseInt($.add($.parent()).filter("[data-sap-ui-rowindex]").data("sap-ui-rowindex"));}var F=t.getFixedBottomRowCount()||0;return i==t.getVisibleRowCount()-F-1;},getContentDensity:function(t){var u;var v=["sapUiSizeCondensed","sapUiSizeCompact","sapUiSizeCozy"];var G=function(F,O){if(!O[F]){return;}for(var i=0;i<v.length;i++){if(O[F](v[i])){return v[i];}}};var $=t.$();if($.length>0){u=G("hasClass",$);}else{u=G("hasStyleClass",t);}if(u){return u;}var P=null;var w=t.getParent();if(w){do{u=G("hasStyleClass",w);if(u){return u;}if(w.getDomRef){P=w.getDomRef();}else if(w.getRootNode){P=w.getRootNode();}if(!P&&w.getParent){w=w.getParent();}else{w=null;}}while(w&&!P);}$=q(P||document.body);u=G("hasClass",$.closest("."+v.join(",.")));return u;},isVariableWidth:function(w){return!w||w=="auto"||w.toString().match(/%$/);},getFirstFixedBottomRowIndex:function(t){var F=t.getFixedBottomRowCount();var i=t.getBinding("rows");var u=-1;if(i&&F>0){var v=t.getVisibleRowCount();var w=t.getFirstVisibleRow();var x=t._getTotalRowCount();if(x>=v){u=v-F;}else{var y=x-F-w;if(y>=0&&(w+y)<x){u=y;}}}return u;},getResourceBundle:function(O){O=q.extend({async:false,reload:false},O);if(r&&O.reload!==true){if(O.async===true){return Promise.resolve(r);}else{return r;}}var v=sap.ui.getCore().getLibraryResourceBundle("sap.ui.table",O.async===true);if(v instanceof Promise){v=v.then(function(i){r=i;return r;});}else{r=v;}return v;},getResourceText:function(K,v){return r?r.getText(K,v):"";},dynamicCall:function(O,v,t){var i=O instanceof Function?O():O;if(!i||!v){return undefined;}t=t||i;if(v instanceof Function){v.call(t,i);return undefined;}else{var P;var u=[];for(var F in v){if(i[F]instanceof Function){P=v[F];u.push(i[F].apply(t,P));}else{u.push(undefined);}}if(u.length===1){return u[0];}else{return u;}}},throttle:function(i,O){O=Object.assign({wait:0,leading:true},O);O.maxWait=O.wait;O.trailing=true;O.requestAnimationFrame=false;return s.debounce(i,O);},debounce:function(i,O){O=Object.assign({wait:0,maxWait:null,leading:false,asyncLeading:false,trailing:true,requestAnimationFrame:false},O);var t=null;var u=null;var v=null;var w=O.maxWait!=null;O.wait=Math.max(0,O.wait);O.maxWait=w?Math.max(O.maxWait,O.wait):O.maxWait;function x(H,J,K,N){t=N===true?null:Date.now();if(J==null){return;}if(K===true){var P=Promise.resolve().then(function(){if(!P.canceled){i.apply(H,J);}v=null;});P.cancel=function(){P.canceled=true;};v=P;}else{i.apply(H,J);}}function y(H,J){z();function _(U){U=U!==false;if(U){E();}if(O.trailing){x(H,J,null,U);}}if(O.requestAnimationFrame){u=window.requestAnimationFrame(function(){_();});}else{var N=Date.now();var K=t==null?0:N-t;var P=Math.max(0,w?Math.min(O.maxWait-K,O.wait):O.wait);var Q=P<O.wait;u=setTimeout(function(){if(Q){var U=Math.max(0,(Date.now()-N)-P);var V=O.wait-P;if(U>V){_();}else{u=setTimeout(E,V-U);_(false);}}else{_();}},P);}}function z(){if(O.requestAnimationFrame){window.cancelAnimationFrame(u);}else{clearTimeout(u);}u=null;}function A(){if(v){v.cancel();v=null;}}function E(){z();A();t=null;}function F(){return u!=null;}var G=function(){if(!F()&&!O.leading){x();}if(F()||!O.leading){y(this,arguments);}else if(O.asyncLeading){x(this,arguments,true);y();}else{y();x(this,arguments);}};G.cancel=E;G.pending=F;return G;},getInteractiveElements:function(i){if(!i){return null;}var $=q(i);var t=s.getCellInfo($);if(t.isOfType(j.DATACELL|j.ROWACTION)){var u=$.find(I);if(u.length>0){return u;}}return null;},convertCSSSizeToPixel:function(i,w){var P;if(typeof i!=="string"){return null;}if(i.endsWith("px")){P=parseInt(i);}else if(i.endsWith("em")||i.endsWith("rem")){P=Math.ceil(parseFloat(i)*s.getBaseFontSize());}else{return null;}if(w){return P+"px";}else{return P;}},getBaseFontSize:function(){if(h==null){var i=document.documentElement;if(i){h=parseInt(window.getComputedStyle(i).fontSize);}}return h==null?16:h;},readThemeParameters:function(){function i(t){return s.convertCSSSizeToPixel(T.get(t));}m.undefined=i("_sap_ui_table_BaseSize");m.sapUiSizeCozy=i("_sap_ui_table_BaseSizeCozy");m.sapUiSizeCompact=i("_sap_ui_table_BaseSizeCompact");m.sapUiSizeCondensed=i("_sap_ui_table_BaseSizeCondensed");k=i("_sap_ui_table_BaseBorderWidth");n=k;D.undefined=m.undefined+n;D.sapUiSizeCozy=m.sapUiSizeCozy+n;D.sapUiSizeCompact=m.sapUiSizeCompact+n;D.sapUiSizeCondensed=m.sapUiSizeCondensed+n;}};b.TableUtils=s;d.TableUtils=s;e.TableUtils=s;f.TableUtils=s;return s;},true);
