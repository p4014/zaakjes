/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','sap/ui/model/BindingMode','sap/ui/model/Context','sap/ui/model/Model','sap/ui/model/odata/v2/ODataAnnotations','sap/ui/model/odata/ODataUtils','sap/ui/model/odata/CountMode','sap/ui/model/odata/UpdateMethod','sap/ui/model/odata/OperationMode','./ODataContextBinding','./ODataListBinding','sap/ui/model/odata/ODataMetadata','sap/ui/model/odata/ODataPropertyBinding','./ODataTreeBinding','sap/ui/model/FilterProcessor','sap/ui/model/odata/ODataMetaModel','sap/ui/core/message/MessageParser','sap/ui/model/odata/ODataMessageParser','sap/ui/thirdparty/datajs',"sap/base/Log","sap/base/assert","sap/base/util/uid","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/merge","sap/base/security/encodeURL","sap/ui/thirdparty/jquery","sap/base/util/isPlainObject","sap/base/util/each"],function(U,B,C,M,O,a,b,c,d,e,f,g,h,l,F,m,o,p,q,L,r,u,s,t,v,w,Q,x,y){"use strict";var z=M.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(S,P){M.apply(this,arguments);var i,j,H,T,W,k,n,R,D,E,G,I,J,K,N,V,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1=this;if(typeof(S)==="object"){P=S;S=P.serviceUrl;}if(P){i=P.user;j=P.password;H=P.headers;T=P.tokenHandling;W=P.withCredentials;k=P.maxDataServiceVersion;n=P.useBatch;R=P.refreshAfterChange;D=P.annotationURI;E=P.loadAnnotationsJoined;J=P.defaultBindingMode;G=P.defaultCountMode;I=P.preliminaryContext;K=P.defaultOperationMode;N=P.metadataNamespaces;V=P.serviceUrlParams;X=P.metadataUrlParams;Y=P.json;Z=P.messageParser;$=P.skipMetadataAnnotationParsing;_=P.defaultUpdateMethod;a1=P.disableHeadRequestForToken;b1=P.sequentializeRequests;c1=P.disableSoftStateHeader;d1=P.bindableResponseHeaders;e1=P.warmupUrl;f1=P.canonicalRequests;}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!f1;this.sWarmupUrl=e1;this.bWarmup=!!e1;this.mSupportedBindingModes={"OneWay":true,"OneTime":true,"TwoWay":true};this.mUnsupportedFilterOperators={"Any":true,"All":true};this.sDefaultBindingMode=J||B.OneWay;this.bJSON=Y!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=_||c.Merge;this.bTokenHandling=T!==false;this.bWithCredentials=W===true;this.bUseBatch=n!==false;this.bRefreshAfterChange=R!==false;this.sMaxDataServiceVersion=k;this.bLoadAnnotationsJoined=E!==false;this.sAnnotationURI=D;this.sDefaultCountMode=G||b.Request;this.sDefaultOperationMode=K||d.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!$;this.bDisableHeadRequestForToken=!!a1;this.bSequentializeRequests=!!b1;this.bDisableSoftStateHeader=!!c1;this.aBindableResponseHeaders=d1?d1:null;this.bPreliminaryContext=I||false;this.mMetadataUrlParams=X||{};if(Z){Z.setProcessor(this);}this.oMessageParser=Z;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();this.sServiceUrl=S;var h1=S.split("?");if(h1.length>1){this.sServiceUrl=h1[0];if(h1[1]){this.aUrlParams.push(h1[1]);}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=i;this.sPassword=j;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true");}this.oHeaders={};this.setHeaders(H);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header";}var i1=this._getServerUrl();var j1=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=z._getSharedData("server",i1);this.oSharedServiceData=z._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=z._getSharedData("meta",j1);this.bUseCache=this._cacheSupported(j1);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new g(j1,{async:true,cacheKey:this.bUseCache?j1:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:N,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata;}}else{this.oMetadata=this.oSharedMetaData.oMetadata;}this.oAnnotations=new O(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(j1),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"];}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(V){this.aUrlParams=this.aUrlParams.concat(a._createUrlParamsArray(V));}this.onMetadataFailed=function(k1){g1.fireMetadataFailed(k1.getParameters());};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed);}this.oMetadata.loaded().then(function(){g1._initializeMetadata();});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata";}else{this.oHeaders["Accept"]="application/json";}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml";}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion;}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});z.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};z.prototype.attachBatchRequestFailed=function(D,i,j){this.attachEvent("batchRequestFailed",D,i,j);return this;};z.prototype.detachBatchRequestFailed=function(i,j){this.detachEvent("batchRequestFailed",i,j);return this;};z.prototype.fireBatchRequestFailed=function(i){this.fireEvent("batchRequestFailed",i);return this;};z.prototype.attachBatchRequestSent=function(D,i,j){this.attachEvent("batchRequestSent",D,i,j);return this;};z.prototype.detachBatchRequestSent=function(i,j){this.detachEvent("batchRequestSent",i,j);return this;};z.prototype.fireBatchRequestSent=function(i){this.fireEvent("batchRequestSent",i);return this;};z.prototype.attachBatchRequestCompleted=function(D,i,j){this.attachEvent("batchRequestCompleted",D,i,j);return this;};z.prototype.detachBatchRequestCompleted=function(i,j){this.detachEvent("batchRequestCompleted",i,j);return this;};z.prototype.fireBatchRequestCompleted=function(i){this.fireEvent("batchRequestCompleted",i);return this;};z.mSharedData={server:{},service:{},meta:{}};z._getSharedData=function(S,k){var i=this.mSharedData[S][k];if(!i){i={};this.mSharedData[S][k]=i;}return i;};z.prototype._initializeMetadata=function(){if(this.bDestroyed){return;}var i=function(){this.fireMetadataLoaded({metadata:this.oMetadata});L.debug(this+" - metadataloaded fired");}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(i,this.fireMetadataFailed.bind(this));}else{i();}};z.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh();}};z.prototype.fireAnnotationsLoaded=function(i){this.fireEvent("annotationsLoaded",i);return this;};z.prototype.attachAnnotationsLoaded=function(D,i,j){this.attachEvent("annotationsLoaded",D,i,j);return this;};z.prototype.detachAnnotationsLoaded=function(i,j){this.detachEvent("annotationsLoaded",i,j);return this;};z.prototype.fireAnnotationsFailed=function(i){this.fireEvent("annotationsFailed",i);L.debug(this+" - annotationsfailed fired");return this;};z.prototype.attachAnnotationsFailed=function(D,i,j){this.attachEvent("annotationsFailed",D,i,j);return this;};z.prototype.detachAnnotationsFailed=function(i,j){this.detachEvent("annotationsFailed",i,j);return this;};z.prototype.fireMetadataLoaded=function(i){this.fireEvent("metadataLoaded",i);return this;};z.prototype.attachMetadataLoaded=function(D,i,j){this.attachEvent("metadataLoaded",D,i,j);return this;};z.prototype.detachMetadataLoaded=function(i,j){this.detachEvent("metadataLoaded",i,j);return this;};z.prototype.fireMetadataFailed=function(i){this.fireEvent("metadataFailed",i);return this;};z.prototype.attachMetadataFailed=function(D,i,j){this.attachEvent("metadataFailed",D,i,j);return this;};z.prototype.detachMetadataFailed=function(i,j){this.detachEvent("metadataFailed",i,j);return this;};z.prototype._createEventInfo=function(R,k,n){var E={};E.url=R.requestUri;E.method=R.method;E.async=R.async;E.headers=R.headers;if(n){E.requests=[];for(var i=0;i<n.length;i++){var D={};if(Array.isArray(n[i])){var G=n[i];for(var j=0;j<G.length;j++){var R=G[j].request;var I=n[i][j].response;D={};D.url=R.requestUri;D.method=R.method;D.headers=R.headers;if(I){D.response={};if(R._aborted){D.success=false;D.response.statusCode=0;D.response.statusText="abort";}else{D.success=true;if(I.message){D.response.message=I.message;I=I.response;D.response.responseText=I.body;D.success=false;}D.response.headers=I.headers;D.response.statusCode=I.statusCode;D.response.statusText=I.statusText;}}E.requests.push(D);}}else{var R=n[i].request;var I=n[i].response;D.url=R.requestUri;D.method=R.method;D.headers=R.headers;if(I){D.response={};if(R._aborted){D.success=false;D.response.statusCode=0;D.response.statusText="abort";}else{D.success=true;if(I.message){D.response.message=I.message;I=I.response;D.response.responseText=I.body;D.success=false;}D.response.headers=I.headers;D.response.statusCode=I.statusCode;D.response.statusText=I.statusText;}}E.requests.push(D);}}}if(k){E.response={};E.success=true;if(k.message){E.response.message=k.message;E.success=false;}if(k.response){k=k.response;}if(k&&k.statusCode!=undefined){E.response.headers=k.headers;E.response.statusCode=k.statusCode;E.response.statusText=k.statusText;E.response.responseText=k.body!==undefined?k.body:k.responseText;}}E.ID=R.requestID;return E;};z.prototype._createRequestID=function(){var R;R=u();return R;};z.prototype._getServerUrl=function(){var S,i;S=new U(this.sServiceUrl).absoluteTo(document.baseURI);i=new U("/").absoluteTo(S).toString();return i;};z.prototype._createMetadataUrl=function(i){if(i.indexOf(this.sServiceUrl)==-1){if(!i.startsWith("/")){i="/"+i;}i=this.sServiceUrl+i;}var j=new s(i||window.location.href).mParams||{};Object.keys(j).forEach(function(K){j[K]=j[K][0];});var k=Q.extend({},this.mMetadataUrlParams,j);var n=a._createUrlParamsArray(k);var D=i.split("?");if(D.length>1){i=D[0];}return this._addUrlParams(i,n);};z.prototype._addUrlParams=function(i,j){var k=[];if(this.aUrlParams){k=k.concat(this.aUrlParams);}if(j){k=k.concat(j);}if(k&&k.length>0){i+="?"+k.join("&");}return i;};z.prototype._createRequestUrl=function(P,i,j,k){var n,D="";n=this._normalizePath(P,i);if(!k){D=this.sServiceUrl+n;}else{D=n.substr(n.indexOf('/')+1);}return this._addUrlParams(D,j);};z.prototype._importData=function(D,j,R,P,k,K){var n=this,E,G,H;P=P||"";K=K||"";if(D.results){E=[];y(D.results,function(i,V){K=n._getKey(V);var K=n._importData(V,j,R,P.substr(0,P.lastIndexOf("/")),k,K);if(K){E.push(K);}});return E;}else{if(K){P="/"+K;k+=K.substr(K.indexOf("("));}else{K=this._getKey(D);}if(!K){return K;}H=this._getEntity(K);if(!H||(H.__metadata&&H.__metadata.invalid)){H=D;K=this._addEntity(H);}if(this.aBindableResponseHeaders){var I={};for(var J in R.headers){var N=J.toLowerCase();if(this.aBindableResponseHeaders.indexOf(N)>-1){I[N]=R.headers[J];}}if(!Q.isEmptyObject(I)){if(!D.__metadata){D.__metadata={};}D.__metadata.headers=I;}}y(D,function(i,V){if(V&&(V.__metadata&&V.__metadata.uri||V.results)&&!V.__deferred){var W=P+"/"+i;var X=k+"/"+i;G=n._importData(V,j,R,W,X);if(Array.isArray(G)){H[i]={__list:G};}else{if(H[i]&&H[i].__ref){if(H[i].__ref!==G){n.mInvalidatedPaths[P.substr(P.lastIndexOf("("))+"/"+i]="/"+G;}}H[i]={__ref:G};}}else if(!V||!V.__deferred){H[i]=V;}});var S={};S[K]=H;this._updateChangedEntities(S);j[K]=true;P=P||'/'+K;k=k||P;var T=this.resolveFromCache(k);if(T==="/"+K||(T&&T.split("/").length>2)){this._writePathCache(T,"/"+K);}this._writePathCache(P,"/"+K);this._writePathCache(k,"/"+K);return K;}};z.prototype._writePathCache=function(P,i){if(P&&i){if(!this.mPathCache[P]){this.mPathCache[P]={};}this.mPathCache[P].canonicalPath=i;if(!this.mPathCache[P].updateKey){this.mPathCache[P].updateKey=P.substr(P.lastIndexOf("("));}}};z.prototype._removeReferences=function(D){var j=this,k;if(!D){return D;}if(D.results){k=[];y(D.results,function(i,n){k.push(j._removeReferences(n));});return k;}else{y(D,function(P,i){if(i){if(i["__ref"]||i["__list"]){delete D[P];}}});return D;}};z.prototype._restoreReferences=function(D,V){var j=this,k,n,R;function E(k){var n=V[k];if(!n){n=j._getObject("/"+k);r(n,"ODataModel inconsistent: "+k+" not found!");if(n){n=v({},n);V[k]=n;j._restoreReferences(n,V);}}return n;}if(!V){V={};}y(D,function(P,G){if(G){if(G.__ref){k=G.__ref;n=E(k);if(n){D[P]=n;}delete G.__ref;}else if(G.__list){R=[];y(G.__list,function(i,k){n=E(k);if(n){R.push(n);}});delete G.__list;G.results=R;}}});return D;};z.prototype.removeData=function(){this.oData={};};z.prototype.initialize=function(){var i=this.aBindings.slice(0);i.forEach(function(j){j.initialize();});};z.prototype.invalidate=function(i){var E;for(var k in this.oData){E=this.oData[k];if(!i||i(k,E)){E.__metadata.invalid=true;}}};z.prototype.invalidateEntry=function(E){var i;if(typeof E==="string"){if(E.indexOf("/")===0){i=this._getObject(E);}else{i=this.oData[E];}}else if(E instanceof C){i=this._getObject(E.getPath());}if(i&&i.__metadata){i.__metadata.invalid=true;}};z.prototype.invalidateEntityType=function(E){var i;for(var k in this.oData){i=this.oData[k];if(i.__metadata.type===E){i.__metadata.invalid=true;}}};z.prototype.refresh=function(i,R,G){if(typeof i==="string"){G=i;i=false;R=false;}if(R){this.removeData();}this._refresh(i,G);};z.prototype._refresh=function(i,G,j,E){var k=this.aBindings.slice(0);this.sRefreshGroupId=G;k.forEach(function(n){n._refresh(i,j,E);});this.sRefreshGroupId=undefined;};z.prototype.checkUpdate=function(i,j,k,n){if(j){if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(i,false,k);}.bind(this),0);}return;}if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;}var D=this.aBindings.slice(0);D.forEach(function(E){if(!n||this.isMetaModelPath(E.getPath())){E.checkUpdate(i,k);}}.bind(this));this._processAfterUpdate();};z.prototype.checkDataState=function(i){var j=this.aBindings.slice(0);j.forEach(function(k){if(k.checkDataState){k.checkDataState(i);}});};z.prototype.bindProperty=function(P,i,j){var k=new h(this,P,i,j);return k;};z.prototype.bindList=function(P,i,S,j,k){var n=new f(this,P,i,S,j,k);return n;};z.prototype.bindTree=function(P,i,j,k,S){var n=new l(this,P,i,j,k,S);return n;};z.prototype.createBindingContext=function(P,i,j,k,R){var n,D,N,G,E=this;if(i!==null&&typeof i==="object"&&!(i instanceof sap.ui.model.Context)){R=k;k=j;j=i;i=undefined;}if(typeof i=="function"){R=j;k=i;j=undefined;i=undefined;}if(typeof i=="boolean"){R=i;k=undefined;j=undefined;i=undefined;}if(typeof j=="function"){R=k;k=j;j=undefined;}if(typeof j=="boolean"){R=j;k=undefined;j=undefined;}if(typeof k=="boolean"){R=k;k=undefined;}n=this.resolve(P,i,this.bCanonicalRequests);if(!n&&this.bCanonicalRequests){n=this.resolve(P,i);}if(!n){if(k){k(null);}return null;}if(R===undefined){R=this._isReloadNeeded(n,j);}if(!R){D=this.resolve(P,i,true);if(D){N=this.getContext(D,i);N.sDeepPath=this.resolveDeep(P,i,false);}else{N=null;}if(k){k(N);}return N;}function H(T){var V=T?E._getKey(T):null,W=!(P===""||P.indexOf("/")>0),X=null,Y,Z;N=null;if(V){N=E.getContext('/'+V,i);N.sDeepPath=E.resolveDeep(P,i);X={__ref:V};}if(i&&J&&W){Y=i.getPath();Y=Y.substr(1);Z=E._getEntity(Y);if(Z){Z[P]=X;}}k(N);}function I(T){var V;if(T.statusCode=='404'&&i&&J){var W=i.getPath();W=W.substr(1);V=E._getEntity(W);if(V){V[P]={__ref:null};}}k(null);}if(k){var J=!P.startsWith("/");if(n){var K=[],S=this.createCustomParams(j);if(S){K.push(S);}if(j&&(j.batchGroupId||j.groupId)){G=j.groupId||j.batchGroupId;}this.read(n,{groupId:G,urlParameters:K,success:H,error:I});}else{k(null);}}if(j&&j.createPreliminaryContext){n=this.resolve(P,i);N=this.getContext(n);N.sDeepPath=this.resolveDeep(P,i);return N;}};z.prototype._updateContext=function(i,P){if(!P.startsWith("/")){throw new Error("Path "+P+" must start with a / ");}i.sPath=P;this.mContexts[P]=i;};z.prototype._splitEntries=function(E){return E.replace(/\s/g,"").split(',').map(function(i){return i.split("/");});};z.prototype._filterOwnSelect=function(S,E){var i,j;if(!E){return[];}j=E.map(function(P){return P.name;});i=S.filter(function(k){return k.length===1;}).map(function(k){return k[0];});if(S.length===0||i.indexOf("*")!==-1||i.indexOf("**")!==-1){return j;}else{return i.filter(function(k){return j.indexOf(k)!==-1;});}};z.prototype._filterOwnExpand=function(E,S){return E.map(function(i){return i[0];}).filter(function(V,i,j){return j.indexOf(V)===i;}).filter(function(V){return S.length===0||S.some(function(i){return i.indexOf(V)===0||i.indexOf("**")===0;});});};z.prototype._filterSelectByNavProp=function(E,n){return E.filter(function(S){return S[0]===n;}).map(function(S){return S.length>1?S.slice(1):["**"];});};z.prototype._filterExpandByNavProp=function(E,n){return E.filter(function(S){return S.length>1&&S[0]===n;}).map(function(S){return S.slice(1);});};z.prototype._isReloadNeeded=function(P,k){var n=this,D=this.oMetadata,E,G=this._getObject(P),H=[],S=[];if(!this.oMetadata.isLoaded()){return true;}E=this.oMetadata._getEntityTypeByPath(P);if(this._isCreatedEntity(G)){return false;}function I(E,G,S,H){var J,K,N,R,T,V,W,X,Y;if(!E){return false;}if(G===null){return false;}if(!G){return true;}if(G.__metadata&&G.__metadata.invalid){return true;}J=n._filterOwnSelect(S,E.property);for(var i=0;i<J.length;i++){Y=J[i];if(G[Y]===undefined){return true;}}K=n._filterOwnExpand(H,S);for(var i=0;i<K.length;i++){X=K[i];N=G[X];if(N===null){continue;}if(N===undefined||N.__deferred){return true;}R=D._getEntityTypeByNavProperty(E,X);V=n._filterSelectByNavProp(S,X);W=n._filterExpandByNavProp(H,X);if(N.__ref){T=n._getEntity(N.__ref);if(I(R,T,V,W)){return true;}}if(N.__list){for(var j=0;j<N.__list.length;j++){T=n._getEntity(N.__list[j]);if(I(R,T,V,W)){return true;}}}}return false;}if(k){if(k.select){S=this._splitEntries(k.select);}if(k.expand){H=this._splitEntries(k.expand);}}return I(E,G,S,H);};z.prototype.createCustomParams=function(P){var i=[],j,S={expand:true,select:true};for(var n in P){if(n in S){i.push("$"+n+"="+w(P[n]));}if(n==="custom"){j=P[n];for(n in j){if(n.indexOf("$")===0){L.warning(this+" - Trying to set OData parameter '"+n+"' as custom query option!");}else if(typeof j[n]==='string'){i.push(n+"="+w(j[n]));}else{i.push(n);}}}}return i.join("&");};z.prototype.bindContext=function(P,i,j){var k=new e(this,P,i,j);return k;};z.prototype.setDefaultCountMode=function(i){this.sDefaultCountMode=i;};z.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode;};z.prototype._addEntity=function(E){var k=this._getKey(E);this.oData[k]=E;return k;};z.prototype._removeEntity=function(k){k=k&&a._normalizeKey(k);delete this.oData[k];delete this.mChangedEntities[k];delete this.mContexts["/"+k];};z.prototype._getEntity=function(k){var E=this.oData[k];if(!E){k=k&&a._normalizeKey(k);E=this.oData[k];}return E;};z.prototype._getKey=function(V){var k,i;if(V instanceof C){k=V.getPath().substr(1);}else if(V&&V.__metadata&&V.__metadata.uri){i=V.__metadata.uri;k=i.substr(i.lastIndexOf("/")+1);}else if(typeof V==='string'){k=V.substr(V.lastIndexOf("/")+1);}if(!this.oData[k]){k=k&&a._normalizeKey(k);}return k;};z.prototype.getKey=function(V){return this._getKey(V);};z.prototype.createKey=function(j,k){var E=this.oMetadata._getEntityTypeByPath(j),K=j,n=this,N,P;r(E,"Could not find entity type of collection \""+j+"\" in service metadata!");K+="(";if(E.key.propertyRef.length===1){N=E.key.propertyRef[0].name;r(N in k,"Key property \""+N+"\" is missing in object!");P=this.oMetadata._getPropertyMetadata(E,N);K+=encodeURIComponent(a.formatValue(k[N],P.type));}else{y(E.key.propertyRef,function(i,D){if(i>0){K+=",";}N=D.name;r(N in k,"Key property \""+N+"\" is missing in object!");P=n.oMetadata._getPropertyMetadata(E,N);K+=N;K+="=";K+=encodeURIComponent(a.formatValue(k[N],P.type));});}K+=")";return K;};z.prototype.getProperty=function(P,i,I){var V=this._getObject(P,i);if(!I){return V;}if(!x(V)){return V;}V=v({},V);if(I===true){return this._restoreReferences(V);}else{return this._removeReferences(V);}};z.prototype.getObject=function(P,n,D){if(x(n)){D=n;n=undefined;}var E=this,R=this.resolve(P,n),V=this._getObject(R),G=this.oMetadata._getEntityTypeByPath(R),H=[],S=[];if(!G||!x(V)||!V.__metadata||!V.__metadata.uri){return V;}if(!D||!(D.select||D.expand)){return v({},V);}function I(G,V,S,H){var J,K,N,T,W,X,Y,Z,$,_,a1,b1,c1;if(!V){return undefined;}if(!G){return undefined;}N=E._filterOwnSelect(S,G.property);K={};for(var i=0;i<N.length;i++){b1=N[i];if(V[b1]!==undefined){K[b1]=V[b1];}else{L.fatal("No data loaded for select property: "+b1+" of entry: "+E.getKey(V));return undefined;}}if(V.__metadata){K.__metadata=V.__metadata;}J=E._filterOwnExpand(H,S);for(var i=0;i<J.length;i++){a1=J[i];W=V[a1];X=E.oMetadata._getEntityTypeByNavProperty(G,a1);$=E._filterSelectByNavProp(S,a1);_=E._filterExpandByNavProp(H,a1);if(W&&W.__ref){Z=E._getObject("/"+W.__ref);Y=I(X,Z,$,_);if(Y!==undefined){K[a1]=Y;}else{L.fatal("No data loaded for expand property: "+a1+" of entry: "+E.getKey(Y));return undefined;}}if(W&&W.__list){c1=[];for(var j=0;j<W.__list.length;j++){Z=E._getObject("/"+W.__list[j]);Y=I(X,Z,$,_);if(Y!==undefined){c1.push(Y);}else{L.fatal("No data loaded for expand property: "+a1+" of entry: "+E.getKey(Y));return undefined;}}K[a1]=c1;}}T=E._filterOwnSelect(S,G.navigationProperty);for(var k=0;k<T.length;k++){a1=T[k];if(J.indexOf(a1)===-1){var d1=K.__metadata.uri+"/"+a1;K[a1]={__deferred:{uri:d1}};}}return K;}if(D.select){S=this._splitEntries(D.select);}if(D.expand){H=this._splitEntries(D.expand);}V=I(G,V,S,H);return V;};z.prototype._getObject=function(P,i,j){var n=this.isLegacySyntax()?this.oData:null,k,D,R,S,E,G,H,K,I;R=this.resolve(P,i,this.bCanonicalRequests);if(!R&&this.bCanonicalRequests){R=this.resolve(P,i);}if(!R){return n;}if(this._isMetadataPath(R)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(R)){S=R.indexOf('/##');I=this.getMetaModel();if(!this.bMetaModelLoaded){return null;}E=R.substr(0,S);G=R.substr(S+3);H=I.getMetaContext(E);n=I.getProperty(G,H);}else{n=this.oMetadata._getAnnotation(R);}}}else{if(R==="/"){return this.oData;}var J=R.split("/"),N=0;K=J[1];J.splice(0,2);k=this.mChangedEntities[K];D=this._getEntity(K);n=j?D:k||D;while(n&&J[N]){var T=k&&k.hasOwnProperty(J[N]);k=k&&k[J[N]];D=D&&D[J[N]];n=j||!T?D:k;if(n){if(n.__ref){k=this.mChangedEntities[n.__ref];D=this._getEntity(n.__ref);n=j?D:k||D;}else if(n.__list){n=n.__list;}else if(n.__deferred){n=undefined;}}N++;}}if(x(k)){n=j?D:v({},D,k);}return n;};z.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken();}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}};z.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken;};z.prototype.getSecurityToken=function(){var T=this.oSharedServiceData.securityToken;if(!T){this.refreshSecurityToken();T=this.oSharedServiceData.securityToken;}return T;};z.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken);}else{this.pSecurityToken=new Promise(function(i,j){this.refreshSecurityToken(function(){i(this.oSharedServiceData.securityToken);}.bind(this),function(){j();},true);}.bind(this));}}return this.pSecurityToken;};z.prototype.refreshSecurityToken=function(S,E,i){var T;var j=this;var k=this._createRequestUrl("/");var n={abort:function(){this.request.abort();}};function D(J,R){if(R){T=j._getHeader("x-csrf-token",R.headers);j._setSessionContextIdHeader(j._getHeader("sap-contextid",R.headers));if(T){j.oSharedServerData.securityToken=T;j.oSharedServiceData.securityToken=T;j.pSecurityToken=Promise.resolve(T);j.oHeaders["x-csrf-token"]=T;}else{j.resetSecurityToken();j.bTokenHandling=false;}}if(S){S(J,R);}}function G(J){j.resetSecurityToken();j.bTokenHandling=false;j._handleError(J);if(E){E(J);}}function H(J){n.request=I("GET",G);}function I(R,E){var J=j._createRequest(k,R,j._getHeaders(undefined,true),null,null,!!i);J.headers["x-csrf-token"]="Fetch";return j._request(J,D,E,undefined,undefined,j.getServiceMetadata());}if(this.bDisableHeadRequestForToken){n.request=I("GET",G);}else{n.request=I("HEAD",H);}return n;};z.prototype._submitRequest=function(R,S,E){var j=this,H,k,n,D,G;D=new Promise(function(i,V){G=i;});function I(i,V){if(S){S(i,V);}G();}function J(i){if(j.bTokenHandling&&i.response){var V=j._getHeader("x-csrf-token",i.response.headers);if(!R.bTokenReset&&i.response.statusCode=='403'&&V&&V.toLowerCase()==="required"){j.resetSecurityToken();R.bTokenReset=true;N();return;}}if(E){E(i);}G();}function K(R){if(j.bTokenHandling&&R.method!=="GET"){j.pReadyForRequest=j.securityTokenAvailable();}return j.pReadyForRequest;}function N(){if(j.bTokenHandling){delete R.headers["x-csrf-token"];}K(R).then(function(i){if(j.bTokenHandling&&R.method!=="GET"){R.headers["x-csrf-token"]=i;}T();},function(){T();});}function P(V,R,W){var X,Y=R.eventInfo.requests;if(Y){y(Y,function(i,R){if(Array.isArray(R)){R.forEach(function(R){y(R.parts,function(i,Z){X=j._createEventInfo(R.request,Z.fnError);j["fireRequest"+V](X);});});}else{if(R.parts){y(R.parts,function(i,Z){X=j._createEventInfo(R.request,Z.fnError);j["fireRequest"+V](X);});}else{X=j._createEventInfo(R.request,R.fnError);j["fireRequest"+V](X);}}});if(R.eventInfo.batch){X=j._createEventInfo(R,W,Y);j["fireBatchRequest"+V](X);}}}function T(){if(j.sSessionContextId){R.headers["sap-contextid"]=j.sSessionContextId;}k=j._request(R,I,J,H,undefined,j.getServiceMetadata());if(R.eventInfo){P("Sent",R,null);delete R.eventInfo;}if(n){k.abort();}}H=j._getODataHandler(R.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){N();});this.pSequentialRequestCompleted=D;}else{N();}return{abort:function(){if(k){k.abort();}n=true;}};};z.prototype._setSessionContextIdHeader=function(S){if(S){this.sSessionContextId=S;}};z.prototype._submitSingleRequest=function(R){var j=this,k,n={},G={},E={};function D(I,J){if(I===undefined&&J.statusCode===200){H({message:"Response did not contain a valid OData result",response:J});return;}function K(I,J){for(var i=0;i<R.parts.length;i++){if(R.parts[i].request._aborted){j._processAborted(R.parts[i].request,J);}else if(R.parts[i].fnSuccess){R.parts[i].fnSuccess(I,J);}}if(R.request.requestUri.indexOf("$count")===-1){j.checkUpdate(false,false,G);if(R.bRefreshAfterChange){j._refresh(false,undefined,n,E);}}}j._processSuccess(R.request,J,K,G,n,E);j._invalidatePathCache();j._setSessionContextIdHeader(j._getHeader("sap-contextid",J.headers));}function H(I){if(I.message=="Request aborted"){for(var i=0;i<R.parts.length;i++){j._processAborted(R.parts[i].request,I);}}else{for(var i=0;i<R.parts.length;i++){j._processError(R.parts[i].request,I,R.parts[i].fnError);}}j._processAfterUpdate();}R.request.eventInfo={requests:R.parts,batch:false};k=this._submitRequest(R.request,D,H);return k;};z.prototype._submitBatchRequest=function(k,R,S,E){var n=this,D={},G={},H={};function I(j,V,W){for(var i=0;i<j.parts.length;i++){if(W||j.parts[i].request._aborted){n._processAborted(j.parts[i].request,V);}else if(V.message){n._processError(j.parts[i].request,V,j.parts[i].fnError);}else{n._processSuccess(j.parts[i].request,V,j.parts[i].fnSuccess,G,D,H);}}}function J(V,W){if(V===undefined&&W.statusCode===200){K({message:"Response did not contain a valid OData batch result",response:W});return;}var X,Y,Z,$=V.__batchResponses;if($){var i,j;for(i=0;i<$.length;i++){X=$[i];if(Array.isArray(R[i])){if(X.message){for(j=0;j<R[i].length;j++){Y=R[i][j];I(Y,X);Y.response=X;}}else{Z=X.__changeResponses;for(j=0;j<Z.length;j++){var _=Z[j];Y=R[i][j];I(Y,_);Y.response=_;}}}else{Y=R[i];I(Y,X);Y.response=X;}}n._invalidatePathCache();n.checkUpdate(false,false,G);}n._processSuccess(k,W,S,G,D,H,true,R);n._setSessionContextIdHeader(n._getHeader("sap-contextid",W.headers));}function K(j){var V=j.message=="Request aborted";y(R,function(i,W){if(Array.isArray(W)){W.forEach(function(W){I(W,j,V);});}else{I(W,j,V);}});n._processAfterUpdate();if(V){n._processAborted(k,j,true);}else{n._processError(k,j,E,true,R);}}k.eventInfo={requests:R,batch:true};var N=this._submitRequest(k,J,K);function P(j){var E;for(var i=0;i<j.parts.length;i++){E=j.parts[i].fnError;if(!j.parts[i].request._aborted&&E){E(A);}}}var T={abort:function(){y(R,function(i,j){if(Array.isArray(j)){j.forEach(function(j){P(j);});}else{P(j);}});N.abort();}};return T;};z.prototype._invalidatePathCache=function(){var i=this,I;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(k){for(var j in i.mInvalidatedPaths){I=k.indexOf(j);if(I>-1){if(I+j.length!==i.mPathCache[k].canonicalPath.length){var E=k.substr(I+j.length);i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[j]+E;}else{i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[j];}}}});}this.mInvalidatedPaths={};};z.prototype._createBatchRequest=function(i){var j,R,k={},P={},n=true;P.__batchRequests=i;for(var I in i){if(i[I]&&i[I].__changeRequests||i[I]&&i[I].headers&&!i[I].headers['sap-cancel-on-close']){n=false;break;}}j=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){j+="?"+this.aUrlParams.join("&");}Q.extend(k,this.mCustomHeaders,this.oHeaders);k["Accept"]="multipart/mixed";delete k["Content-Type"];k['sap-cancel-on-close']=n;R={headers:k,requestUri:j,method:"POST",data:P,user:this.sUser,password:this.sPassword,async:true};R.withCredentials=this.bWithCredentials;return R;};z.prototype.abortInternalRequest=function(k,G){var R=this.mRequests;if(G in this.mDeferredGroups){R=this.mDeferredRequests;}var j=R[G];if(j&&k in j.map){var n=j.map[k];for(var i=0;i<n.parts.length;i++){n.parts[i].requestHandle.abort();}}};z.prototype._pushToRequestQueue=function(R,G,i,j,S,E,k,n){var D=R[G],H=j.key?j.key:j.method+":"+j.requestUri;if(this.bWarmup){return;}if(!D){D={};D.map={};D.requests=[];R[G]=D;}if(H in D.map&&(j.key||j.method==='GET')){var I=D.map[H];var J=I.request;if(I.bRefreshAfterChange===undefined){I.bRefreshAfterChange=n;}if(!j.key){I.parts.push({request:j,fnSuccess:S,fnError:E,requestHandle:k});}if(j.method==="GET"){delete J.data;}else{J.method=j.method;J.headers=j.headers;J.data=j.data;J.requestUri=j.requestUri;if(j.method==="PUT"){delete J.headers["x-http-method"];}if(J._aborted){delete J._aborted;}}}else{var I={request:j,bRefreshAfterChange:n,parts:[{request:j,fnSuccess:S,fnError:E,requestHandle:k}]};if(j.method==="GET"){D.requests.push(I);}else{if(!D.changes){D.changes={};}var K=D.changes[i];if(!K){K=[];D.changes[i]=K;}I.changeSetId=i;K.push(I);}D.map[H]=I;}};z.prototype._collectChangedEntities=function(G,j,E){var k=this;if(G.changes){y(G.changes,function(n,D){for(var i=0;i<D.length;i++){if(D[i].bRefreshAfterChange){var R=D[i].request,P="/"+R.requestUri.split("?")[0],H,K;if(R.method==="POST"||R.method==="DELETE"){var I=k.oMetadata._getEntityTypeByPath(P);if(I){E[I.entityType]=true;}}else{H=k._getObject(P);if(H){K=k._getKey(H);}else if(P.lastIndexOf("/")===0){K=k._getKey(P);}if(K){j[K]=true;}}}}});}};z.prototype._processRequestQueue=function(R,G,S,E){var j=this,P,k=[];function n(H,W){for(var i=0;i<H.parts.length;i++){var I=H.parts[i];if(I.request._aborted){j._processAborted(H.request,null);H.parts.splice(i,1);i--;}else if(W){I.request._handle=W;W.iRelevantRequests++;}}}function D(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort();}}};}if(this.bUseBatch){y(R,function(i,H){if(i===G||!G){var I={},J={};j._collectChangedEntities(H,I,J);if(Object.keys(I).length||Object.keys(J).length){j.bIncludeInCurrentBatch=true;j._refresh(false,i,I,J);j.bIncludeInCurrentBatch=false;}}});y(R,function(H,I){if(H===G||!G){var J=[],K=[],N,T;var W=D();if(I.changes){y(I.changes,function(Y,Z){N={__changeRequests:[]};T=[];for(var i=0;i<Z.length;i++){P='/'+j.getKey(Z[i].request.data);j.increaseLaundering(P,Z[i].request.data);n(Z[i],W);if(Z[i].parts.length>0){if(Z[i].request.data&&Z[i].request.data.__metadata){delete Z[i].request.data.__metadata.created;}N.__changeRequests.push(Z[i].request);T.push(Z[i]);}}if(N.__changeRequests&&N.__changeRequests.length>0){J.push(N);K.push(T);}});}if(I.requests){var V=I.requests;for(var i=0;i<V.length;i++){n(V[i],W);if(V[i].parts.length>0){J.push(V[i].request);K.push(V[i]);}}}if(J.length>0){var X=j._createBatchRequest(J);W.oRequestHandle=j._submitBatchRequest(X,K,S,E);k.push(W.oRequestHandle);}delete R[H];}});}else{y(R,function(H,I){if(H===G||!G){if(I.changes){y(I.changes,function(K,N){for(var i=0;i<N.length;i++){var W=D();P='/'+j.getKey(N[i].request.data);j.increaseLaundering(P,N[i].request.data);n(N[i],W);if(N[i].parts.length>0){W.oRequestHandle=j._submitSingleRequest(N[i]);k.push(W.oRequestHandle);}}});}if(I.requests){var J=I.requests;for(var i=0;i<J.length;i++){var W=D();n(J[i],W);if(J[i].parts.length>0){W.oRequestHandle=j._submitSingleRequest(J[i]);k.push(W.oRequestHandle);}}}delete R[H];}});}this.checkDataState(this.mLaunderingState);return k.length==1?k[0]:k;};z.prototype._processRequestQueueAsync=function(R){var i=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){i._processRequestQueue(R);i.pCallAsync=undefined;});});}};z.prototype._processSuccess=function(R,i,S,G,j,E,k,n){var D=i.data,I,H,J,P,K,N,T,V={},W={},X=this;if(!k){H=!(i.statusCode===204||i.statusCode==='204');J=R.requestUri;P=J.replace(this.sServiceUrl,"");if(!P.startsWith('/')){P='/'+P;}P=this._normalizePath(P);this.decreaseLaundering(P,R.data);if(H&&D===undefined&&i){this._parseResponse(i,R);L.fatal(this+" - No data was retrieved by service: '"+i.requestUri+"'");X.fireRequestCompleted({url:i.requestUri,type:"GET",async:i.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false;}if(D&&D.results&&!Array.isArray(D.results)){D=D.results;}if(!i._imported&&D&&(Array.isArray(D)||typeof D=='object')){I=v({},D);if(R.key||R.created){X._importData(I,V,i);}else{X._importData(I,V,i,P,R.deepPath);}i._imported=true;}N=this._getEntity(R.key);if(V&&N&&N.__metadata.created&&N.__metadata.created.functionImport){var Y=[];var Z=N["$result"];if(Z&&Z.__list){y(V,function(_){Y.push(_);});Z.__list=Y;}else if(Z&&Z.__ref){y(V,function(_){Z.__ref=_;});}}if(!H){K=P.split("/");if(K[1]){W[K[1]]=R;var $={};$[K[1]]=R.data;this._updateChangedEntities($);}if(R.method==="DELETE"&&K[2]!=="$links"){this._removeEntity(K[1]);}}if(H&&R.method==="POST"){T=this.oMetadata._getEntityTypeByPath(P);if(T){E[T.entityType]=true;}if(R.key){if(R.created){var _=this._getKey(D);var a1=this.getContext("/"+R.key);a1.bCreated=false;this._updateContext(a1,'/'+_);N=this._getEntity(_);if(N){delete N.__metadata.created;}}this._removeEntity(R.key);}}this._parseResponse(i,R,V,W);Q.extend(G,V);Q.extend(j,W);this._updateETag(R,i);}if(S){S(D,i);}var b1=this._createEventInfo(R,i,n);if(k){this.fireBatchRequestCompleted(b1);}else{this.fireRequestCompleted(b1);}return true;};z.prototype._processError=function(R,i,E,j,k){var P,n=this._handleError(i,R);if(!j){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);}if(E){E(n);}var D=this._createEventInfo(R,n,k);if(j){this.fireBatchRequestCompleted(D);this.fireBatchRequestFailed(D);}else{this.fireRequestCompleted(D);this.fireRequestFailed(D);}};var A={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};z.prototype._processAborted=function(R,i,j){var P;if(!j){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);}if(i){var E=this._createEventInfo(R,A);E.success=false;if(j){this.fireBatchRequestCompleted(E);}else{this.fireRequestCompleted(E);}}};z.prototype._processAfterUpdate=function(){var j=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var i=0;i<j.length;i++){j[i]();}};z.prototype._processChange=function(k,D,i){var P,E,j,G,H,I,J,K,N,R,S,T=this;E=this.oMetadata._getEntityTypeByPath(k);if(!i){i="MERGE";}P=v({},this._getObject('/'+k,true),D);if(D.__metadata&&D.__metadata.created){G=D.__metadata.created.method?D.__metadata.created.method:"POST";k=D.__metadata.created.key;J=true;j=D.__metadata.created;if(D.__metadata.created.functionImport){j.urlParameters=this._createFunctionImportParameters(D.__metadata.created.key,G,P);P=undefined;}else{delete P.__metadata['uri'];}}else if(i==="MERGE"){G="MERGE";S=this._getEntity(k);}else{G="PUT";}if(P&&P.__metadata){for(var n in P.__metadata){if(n!=='type'&&n!=='uri'&&n!=='etag'&&n!=='content_type'&&n!=='media_src'){delete P.__metadata[n];}}}if(P&&E){var V=this.oMetadata._getNavigationPropertyNames(E);V.forEach(function(Y){delete P[Y];});}if(G==="MERGE"&&E&&S){y(P,function(Y,Z){if(Y!=='__metadata'){if(t(S[Y],Z)&&!T.isLaundering('/'+k+'/'+Y)){delete P[Y];}}});var W="/"+k,X;y(P,function(Y,Z){if(Y!=='__metadata'){X=T.getProperty(W+"/"+Y+"/#@sap:unit");if(X){if(P[X]===undefined){P[X]=S[X];}}}});}P=this._removeReferences(P);N=j&&j.urlParameters?a._createUrlParamsArray(j.urlParameters):undefined;K=j?this._getHeaders(j.headers):this._getHeaders();H=j&&j.eTag?j.eTag:this.getETag(P);I=this._createRequestUrl('/'+k,null,N,this.bUseBatch);R=this._createRequest(I,G,K,P,H);R.deepPath=T.resolveDeep(I);if(J){R.created=true;}if(this.bUseBatch){R.requestUri=R.requestUri.replace(this.sServiceUrl+'/','');}return R;};z.prototype._resolveGroup=function(k){var i,E,P,G,j,D;E=this.oMetadata._getEntityTypeByPath(k);D=this._getObject('/'+k);if(D){P=D.__metadata.created;if(P){return{groupId:P.groupId,changeSetId:P.changeSetId};}}if(this.mChangeGroups[E.name]){i=this.mChangeGroups[E.name];G=i.groupId;j=i.single?u():i.changeSetId;}else if(this.mChangeGroups['*']){i=this.mChangeGroups['*'];G=i.groupId;j=i.single?u():i.changeSetId;}return{groupId:G,changeSetId:j};};z.prototype._updateETag=function(R,i){var j,E,k;j=R.requestUri.replace(this.sServiceUrl+'/','');if(!j.startsWith("/")){j="/"+j;}E=this._getObject(j.split("?")[0]);k=this._getHeader("etag",i.headers);if(E&&E.__metadata&&k){E.__metadata.etag=k;}};z.prototype._handleError=function(E,R){var P={},T;var i="The following problem occurred: "+E.message;P.message=E.message;if(E.response){this._parseResponse(E.response,R);if(this.bTokenHandling){T=this._getHeader("x-csrf-token",E.response.headers);if(E.response.statusCode=='403'&&T&&T.toLowerCase()==="required"){this.resetSecurityToken();}}i+=E.response.statusCode+","+E.response.statusText+","+E.response.body;P.statusCode=E.response.statusCode;P.statusText=E.response.statusText;P.headers=E.response.headers;P.responseText=E.response.body;}L.fatal(i);return P;};z.prototype.getData=function(P,i,I){return this.getProperty(P,i,I);};z.prototype._getODataHandler=function(i){if(i.indexOf("$batch")>-1){return q.batchHandler;}else if(i.indexOf("$count")>-1){return undefined;}else if(this.bJSON){return q.jsonHandler;}else{return q.atomHandler;}};z.prototype.getETag=function(P,i,E){if(typeof P=="object"){E=P;P="";}return this._getETag(P,i,E);};z.prototype._getETag=function(P,i,D){if(!D||!D.__metadata){D=this._getObject(P,i);}if(D&&D.__metadata){return D.__metadata.etag;}return null;};z.prototype.forceEntityUpdate=function(k){var D=this.mChangedEntities[k];if(D&&D.__metadata){D.__metadata.etag='*';}else{L.error(this+" - Entity with key "+k+" does not exist or has no change");}};z.prototype._createRequest=function(i,j,H,D,E,k){k=k!==false;if(E&&j!=="GET"){H["If-Match"]=E;}if(!H["Content-Type"]&&j!=="DELETE"&&j!=="GET"){if(this.bJSON){H["Content-Type"]="application/json";}else{H["Content-Type"]="application/atom+xml";}}if(i.indexOf("$count")>-1){H["Accept"]="text/plain, */*;q=0.5";}if(j==="MERGE"&&!this.bUseBatch){H["x-http-method"]="MERGE";j="POST";}var R={headers:H,requestUri:i,method:j,user:this.sUser,password:this.sPassword,async:k};if(D){R.data=D;}if(this.bWithCredentials){R.withCredentials=this.bWithCredentials;}R.requestID=this._createRequestID();return R;};z.prototype._processRequest=function(P,E){var R,i,j=false,k=this;if(this.bWarmup){return{abort:function(){}};}R={abort:function(){if(!j&&E){E(A);}if(i){i._aborted=true;if(i._handle){i._handle.abort();}}j=true;}};this.oMetadata.loaded().then(function(){i=P(R);k._processRequestQueueAsync(k.mRequests);if(j){R.abort();}});return R;};z.prototype.update=function(P,D,i){var S,E,R,j,k,n,G,H,I,J,K,N,T,V,W=this;if(i){H=i.groupId||i.batchGroupId;I=i.changeSetId;k=i.context;S=i.success;E=i.error;n=i.eTag;K=i.headers;J=i.urlParameters;V=i.refreshAfterChange;if(i.merge!==undefined){N=i.merge?"MERGE":"PUT";}}V=this._getRefreshAfterChange(V,H);G=a._createUrlParamsArray(J);K=this._getHeaders(K);N=N?N:this.sDefaultUpdateMethod;n=n||this._getETag(P,k,D);return this._processRequest(function(X){j=W._createRequestUrl(P,k,G,W.bUseBatch);R=W._createRequest(j,N,K,D,n);R.deepPath=W.resolveDeep(P,k);T=W.mRequests;if(H in W.mDeferredGroups){T=W.mDeferredRequests;}W._pushToRequestQueue(T,H,I,R,S,E,X,V);return R;},E);};z.prototype.create=function(P,D,i){var R,j,E,k,S,n,G,H,I,J,K,N,T,V,W,X=this;if(i){k=i.context;G=i.urlParameters;S=i.success;n=i.error;N=i.groupId||i.batchGroupId;V=i.changeSetId;K=i.eTag;I=i.headers;W=i.refreshAfterChange;}W=this._getRefreshAfterChange(W,N);J=a._createUrlParamsArray(G);I=this._getHeaders(I);T="POST";return this._processRequest(function(Y){j=X._createRequestUrl(P,k,J,X.bUseBatch);R=X._createRequest(j,T,I,D,K);R.deepPath=X.resolveDeep(P,k);R.created=true;P=X._normalizePath(P,k);E=X.oMetadata._getEntityTypeByPath(P);R.entityTypes={};if(E){R.entityTypes[E.entityType]=true;}H=X.mRequests;if(N in X.mDeferredGroups){H=X.mDeferredRequests;}X._pushToRequestQueue(H,N,V,R,S,n,Y,W);return R;},n);};z.prototype.remove=function(P,i){var j,k,S,E,R,n,G,D,H,I,J,K,N,T,V,W=this;if(i){G=i.groupId||i.batchGroupId;D=i.changeSetId;j=i.context;S=i.success;E=i.error;H=i.eTag;K=i.headers;J=i.urlParameters;I=i.refreshAfterChange;}I=this._getRefreshAfterChange(I,G);N=a._createUrlParamsArray(J);K=this._getHeaders(K);T="DELETE";H=H||this._getETag(P,j);function X(Y,Z){k=n.substr(n.lastIndexOf('/')+1);if(k.indexOf('?')!==-1){k=k.substr(0,k.indexOf('?'));}W._removeEntity(k);if(S){S(Y,Z);}}return this._processRequest(function(Y){n=W._createRequestUrl(P,j,N,W.bUseBatch);R=W._createRequest(n,T,K,undefined,H);R.deepPath=W.resolveDeep(P,j);V=W.mRequests;if(G in W.mDeferredGroups){V=W.mDeferredRequests;}W._pushToRequestQueue(V,G,D,R,X,E,Y,I);return R;},E);};z.prototype.callFunction=function(i,P){var R,j,k,n,D,E,S,G,H="GET",I,J,K,N,T=this,V,W,X,Y,Z,$,_,a1={};if(P){I=P.groupId||P.batchGroupId;J=P.changeSetId;H=P.method?P.method:H;D=Object.assign({},P.urlParameters);N=P.eTag;S=P.success;G=P.error;K=P.headers;_=P.refreshAfterChange;}_=this._getRefreshAfterChange(_,I);if(!i.startsWith("/")){L.fatal(this+" callFunction: path '"+i+"' must be absolute!");return;}K=this._getHeaders(K);Z=new Promise(function(b1,c1){X=b1;Y=c1;});$=this._processRequest(function(b1){k=T.oMetadata._getFunctionImportMetadata(i,H);r(k,T+": Function "+i+" not found in the metadata !");if(!k){Y();return;}var c1=k.entitySet||k.entitySetPath;if(c1){a1.$result={__list:[]};if(k.returnType&&k.returnType.indexOf("Collection")==-1){a1.$result={__ref:{}};}}if(k.parameter!=null){y(k.parameter,function(d1,e1){a1[e1.name]=T._createPropertyValue(e1.type);if(D&&D[e1.name]!==undefined){a1[e1.name]=D[e1.name];D[e1.name]=a.formatValue(D[e1.name],e1.type);}else{L.warning(T+" - No value for parameter '"+e1.name+"' found!'");}});}V=i.substring(1)+"('"+u()+"')";a1.__metadata={uri:T.sServiceUrl+'/'+V,created:{key:i.substring(1),success:S,error:G,headers:K,method:H,groupId:I,changeSetId:J,eTag:N,functionImport:true}};V=T._addEntity(a1);W=T.getContext("/"+V);T._writePathCache("/"+V,"/"+V);X(W);E=a._createUrlParamsArray(D);j=T._createRequestUrl(i,null,E,T.bUseBatch);R=T._createRequest(j,H,K,undefined,N);R.deepPath=T.resolveDeep(i,null);R.key=V;n=T.mRequests;if(I in T.mDeferredGroups){n=T.mDeferredRequests;}T._pushToRequestQueue(n,I,J,R,S,G,b1,_);return R;},G);$.contextCreated=function(){return Z;};return $;};z.prototype._createFunctionImportParameters=function(i,j,P){var k=Q.extend(true,{},P);delete k.__metadata;delete k["$result"];var n=this.oMetadata._getFunctionImportMetadata(i,j);r(n,this+": Function "+i+" not found in the metadata !");if(!n){return;}if(n.parameter!=null){y(n.parameter,function(I,D){if(k&&k[D.name]!==undefined){k[D.name]=a.formatValue(k[D.name],D.type);}});}return k;};z.prototype.read=function(P,i){var R,j,k,n,S,E,D,G,H,I,J,K,N,T,V,W,X,Y,Z,$=this;if(i){k=i.context;n=i.urlParameters;S=i.success;E=i.error;D=i.filters;G=i.sorters;X=i.groupId||i.batchGroupId;V=i.headers;}if(this.sRefreshGroupId){X=this.sRefreshGroupId;}T=a._createUrlParamsArray(n);V=this._getHeaders(V,true);W="GET";Y=this._getETag(P,k);var _={abort:function(){if(R){R._aborted=true;}}};function a1(b1){I=a.createSortParams(G);if(I){T.push(I);}var c1=P;var d1=P.indexOf("$count");if(d1!==-1){c1=P.substring(0,d1-1);}N=$._normalizePath(c1,k);K=$.oMetadata._getEntityTypeByPath(N);J=F.groupFilters(D);H=a.createFilterParams(J,$.oMetadata,K);if(H){T.push(H);}j=$._createRequestUrl(P,k,T,$.bUseBatch);R=$._createRequest(j,W,V,null,Y);R.deepPath=$.resolveDeep(P,k);Z=$.mRequests;if(X in $.mDeferredGroups){Z=$.mDeferredRequests;}$._pushToRequestQueue(Z,X,null,R,S,E,b1,false);return R;}if(this.bUseBatch&&this.bIncludeInCurrentBatch){R=a1(_);return _;}else{return this._processRequest(a1,E);}};z.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata();}};z.prototype.metadataLoaded=function(){var i=this.oMetadata.loaded();if(this.bLoadAnnotationsJoined){var j=function(){return i;};return this.pAnnotationsLoaded.then(j,j);}else{return i;}};z.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded;};z.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed();};z.prototype.getServiceAnnotations=function(){var i=this.oAnnotations.getData();return Q.isEmptyObject(i)?null:i;};z.prototype.onAnnotationsFailed=function(E){this.fireAnnotationsFailed(E.getParameters());};z.prototype.onAnnotationsLoaded=function(E){this.fireAnnotationsLoaded(E.getParameters());};z.prototype.addAnnotationUrl=function(i){var j=[].concat(i),k=[],n=[],E=[],D=this;j.forEach(function(G){var I=G.indexOf("$metadata");if(I>=0){G=D._createMetadataUrl(G);k.push(G);}else{n.push(G);}});return this.oMetadata._addUrl(k).then(function(P){return Promise.all(P.map(function(G){E=E.concat(G.entitySets);return D.oAnnotations.addSource({type:"xml",data:G["metadataString"]});}));}).then(function(){return D.oAnnotations.addSource(n);}).then(function(P){return{annotations:D.oAnnotations.getData(),entitySets:E};});};z.prototype.addAnnotationXML=function(X,S){return this.oAnnotations.addSource({type:"xml",data:X});};z.prototype.submitChanges=function(P){var R,G,j,S,E,k,n,D=false,H,I,J=this.bRefreshAfterChange,K,N=this;if(P){G=P.groupId||P.batchGroupId;S=P.success;E=P.error;if(P.merge!==undefined){H=P.merge?"MERGE":"PUT";}}if(G&&!this.mDeferredGroups[G]){L.fatal(this+" submitChanges: \""+G+"\" is not a deferred group!");}I=v({},N.mChangedEntities);this.oMetadata.loaded().then(function(){y(I,function(Z,$){j=N._resolveGroup(Z);if(j.groupId===G||!G){R=N._processChange(Z,$,H||N.sDefaultUpdateMethod);R.key=Z;K=$.__metadata&&$.__metadata.created?$.__metadata.created:{};var k={abort:function(){R._aborted=true;}};if(j.groupId in N.mDeferredGroups){N._pushToRequestQueue(N.mDeferredRequests,j.groupId,j.changeSetId,R,K.success,K.error,k,J);}}});var T,V,W,X,Y,i;for(T in N.mDeferredRequests){W=N.mDeferredRequests[T];for(V in W.changes){X=W.changes[V];for(i=X.length-1;i>=0;i--){Y=X[i];if(Y.bRefreshAfterChange===undefined){Y.bRefreshAfterChange=J;}}}}n=N._processRequestQueue(N.mDeferredRequests,G,S,E);if(D){k.abort();}if(Array.isArray(n)&&n.length==0&&S){S({},undefined);}});k={abort:function(){if(n){if(Array.isArray(n)){n.forEach(function(k){k.abort();});}else{n.abort();}}else{if(!D&&E){E(A);}D=true;}}};return k;};z.prototype._updateChangedEntities=function(i){var j=this,R;function k(n,D){y(D,function(K){var E=R+'/'+K;if(x(D[K])&&x(n[K])){k(n[K],D[K]);if(Q.isEmptyObject(D[K])){delete D[K];}}else if(t(D[K],n[K])&&!j.isLaundering(E)){delete D[K];}});}y(i,function(K,D){if(K in j.mChangedEntities){var E=j._getObject('/'+K,null,true);var n=j._getObject('/'+K);v(E,D);R='/'+K;k(E,n);if(Q.isEmptyObject(n)){delete j.mChangedEntities[K];j.abortInternalRequest(K,j._resolveGroup(K).groupId);}else{j.mChangedEntities[K]=n;n.__metadata={};Q.extend(n.__metadata,E.__metadata);}}});};z.prototype.resetChanges=function(P){var j=this,k,E={},n,D;if(P){y(P,function(I,G){j.getEntityByPath(G,null,E);k=E.propertyPath.split("/");var K=E.key;n=j.mChangedEntities[K];for(var i=0;i<k.length-1;i++){if(n.hasOwnProperty(k[i])){n=n[k[i]];}else{n=undefined;}}if(n){delete n[k[k.length-1]];}if(j.mChangedEntities[K]){D=j.mChangedEntities[K].__metadata;delete j.mChangedEntities[K].__metadata;if(Q.isEmptyObject(j.mChangedEntities[K])||!E.propertyPath){j.oMetadata.loaded().then(function(){j.abortInternalRequest(K,j._resolveGroup(K).groupId);});delete j.mChangedEntities[K];sap.ui.getCore().getMessageManager().removeMessages(j.getMessagesByEntity(K,true));}else{j.mChangedEntities[K].__metadata=D;}}else{L.warning(j+" - resetChanges: "+G+" is not changed");}});}else{y(this.mChangedEntities,function(K,i){j.oMetadata.loaded().then(function(){j.abortInternalRequest(K,j._resolveGroup(K).groupId);});delete j.mChangedEntities[K];sap.ui.getCore().getMessageManager().removeMessages(j.getMessagesByEntity(K,true));});}this.checkUpdate(true);};z.prototype.setProperty=function(P,V,j,k){var n,D,R,E,G,H,I,J,K,N,S,T,W={},X={},Y,Z,$,_=false,a1=this,b1;function c1(d1,e1){y(e1,function(K){if(x(e1[K])&&x(d1[K])){c1(d1[K],e1[K]);if(Q.isEmptyObject(e1[K])){delete e1[K];}}else if(t(e1[K],d1[K])){delete e1[K];}});}I=this.resolve(P,j);H=this.getEntityByPath(I,null,X);if(!H){return false;}D=I.substring(I.lastIndexOf("/")+1);K=X.key;G=this._getObject('/'+K,null,true);n=this._getObject(P,j,true);if(!this.mChangedEntities[K]){T=H.__metadata;H={};H.__metadata=Object.assign({},T);this.mChangedEntities[K]=H;}Z=this.mChangedEntities[K];J=X.propertyPath.split("/");for(var i=0;i<J.length-1;i++){if(!Z.hasOwnProperty(J[i])){Z[J[i]]={};}Z=Z[J[i]];}_=G.__metadata.created&&G.__metadata.created.functionImport;Z[D]=V;if(t(V,n)&&!this.isLaundering('/'+K)&&!_){T=this.mChangedEntities[K].__metadata;b1=T&&T.created;delete this.mChangedEntities[K].__metadata;if(!b1){c1(G,this.mChangedEntities[K]);}if(Q.isEmptyObject(this.mChangedEntities[K])){delete this.mChangedEntities[K];W[K]=true;this.checkUpdate(false,k,W);a1.oMetadata.loaded().then(function(){a1.abortInternalRequest(K,a1._resolveGroup(K).groupId);});return true;}this.mChangedEntities[K].__metadata=T;}N=this._resolveGroup(K);R=this.mRequests;if(N.groupId in this.mDeferredGroups){R=this.mDeferredRequests;E=this._processChange(K,{__metadata:H.__metadata});}else{E=this._processChange(K,this._getObject('/'+K));}E.key=K;Y=Z.__metadata&&Z.__metadata.created?Z.__metadata.created:{};$=this._getRefreshAfterChange(undefined,N.groupId);this.oMetadata.loaded().then(function(){S={abort:function(){E._aborted=true;}};a1._pushToRequestQueue(R,N.groupId,N.changeSetId,E,Y.success,Y.error,S,$);a1._processRequestQueueAsync(a1.mRequests);});W[K]=true;this.checkUpdate(false,k,W);return true;};z.prototype._isHeaderPrivate=function(H){switch(H.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false;}};z.prototype.setHeaders=function(H){var i={},j=this;this.mCustomHeaders={};if(H){y(H,function(k,n){if(j._isHeaderPrivate(k)){L.warning(this+" - modifying private header: '"+k+"' not allowed!");}else{i[k]=n;}});this.mCustomHeaders=i;}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders);}};z.prototype._getHeaders=function(H,i){var j={},k=this;if(H){y(H,function(n,D){if(k._isHeaderPrivate(n)){L.warning(this+" - modifying private header: '"+n+"' not allowed!");}else{j[n]=D;}});}return Q.extend({'sap-cancel-on-close':!!i},this.mCustomHeaders,j,this.oHeaders);};z.prototype.getHeaders=function(){return Q.extend({},this.mCustomHeaders,this.oHeaders);};z.prototype._getHeader=function(H,i){var j;for(j in i){if(j.toLowerCase()===H.toLowerCase()){return i[j];}}return null;};z.prototype.hasPendingChanges=function(){return!Q.isEmptyObject(this.mChangedEntities);};z.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0;};z.prototype.getPendingChanges=function(){return v({},this.mChangedEntities);};z.prototype.updateBindings=function(i){this.checkUpdate(i);};z.prototype.setTokenHandlingEnabled=function(T){this.bTokenHandling=T;};z.prototype.setUseBatch=function(i){this.bUseBatch=i;};z.prototype.formatValue=function(V,T){return a.formatValue(V,T);};z.prototype.deleteCreatedEntry=function(i){var j=this,k,G;if(i){var k=i.getPath().substr(1);G=this._resolveGroup(k).groupId;j.oMetadata.loaded().then(function(){j.abortInternalRequest(k,G);});j._removeEntity(k);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(i.getPath(),true));}};z.prototype.createEntry=function(P,j){var S,E,R,k,n,D,K,G,H,I,J,N,T,V,W,X={},Y,Z="POST",$=this;if(j){W=j.properties;H=j.groupId||j.batchGroupId;I=j.changeSetId;D=j.context;S=j.success;E=j.error;Y=j.created;n=j.eTag;T=j.headers;N=j.urlParameters;J=j.refreshAfterChange;}T=T||{};J=this._getRefreshAfterChange(J,H);H=H?H:this.sDefaultChangeGroup;G=a._createUrlParamsArray(N);var _={abort:function(){if(R){R._aborted=true;}}};function a1(){var b1;if(!P.startsWith("/")){P="/"+P;}var c1=$.oMetadata._getEntityTypeByPath(P);if(!c1){r(c1,"No Metadata for collection "+P+" found");return undefined;}if(typeof W==="object"&&!Array.isArray(W)){X=v({},W);}else{for(var i=0;i<c1.property.length;i++){var d1=c1.property[i];var e1=(W?W.indexOf(d1.name):-1)>-1;if(!W||e1){X[d1.name]=$._createPropertyValue(d1.type);if(e1){W.splice(W.indexOf(d1.name),1);}}}if(W){r(W.length===0,"No metadata for the following properties found: "+W.join(","));}}var f1=$.oMetadata._getEntitySetByType(c1);K=f1.name+"('"+u()+"')";X.__metadata={type:""+c1.entityType,uri:$.sServiceUrl+'/'+K,created:{key:P.substring(1),success:S,error:E,headers:T,urlParameters:N,groupId:H,changeSetId:I,eTag:n}};K=$._addEntity(v({},X));$.mChangedEntities[K]=X;k=$._createRequestUrl(P,D,G,$.bUseBatch);R=$._createRequest(k,Z,T,X,n);R.deepPath=$.resolveDeep(P,D);b1=$.getContext("/"+K);b1.bCreated=true;R.key=K;R.created=true;V=$.mRequests;if(H in $.mDeferredGroups){V=$.mDeferredRequests;}$.oMetadata.loaded().then(function(){$._pushToRequestQueue(V,H,I,R,S,E,_,J);$._processRequestQueueAsync($.mRequests);});return b1;}if(Y){this.oMetadata.loaded().then(function(){Y(a1());});}else if(this.oMetadata.isLoaded()){return a1();}else{L.error("Tried to use createEntry without created-callback, before metadata is available!");}};z.prototype._isCreatedEntity=function(E){return!!(E&&E.__metadata&&E.__metadata.created);};z.prototype._createPropertyValue=function(T){var j=this.oMetadata._splitName(T);var n=j.namespace;var k=j.name;if(n.toUpperCase()!=='EDM'){var D={};var E=this.oMetadata._getObjectMetadata("complexType",k,n);r(E,"Complex type "+T+" not found in the metadata !");for(var i=0;i<E.property.length;i++){var P=E.property[i];D[P.name]=this._createPropertyValue(P.type);}return D;}else{return this._getDefaultPropertyValue(k,n);}};z.prototype._getDefaultPropertyValue=function(T,n){return undefined;};z.prototype._normalizePath=function(P,i){if(P&&P.indexOf('?')!==-1){P=P.substr(0,P.indexOf('?'));}if(!i&&!P.startsWith("/")){L.fatal(this+" path "+P+" must be absolute if no Context is set");}return this.resolve(P,i,this.bCanonicalRequests)||this.resolve(P,i);};z.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange;};z.prototype.setRefreshAfterChange=function(R){this.bRefreshAfterChange=R;};z.prototype.isList=function(P,i){P=this.resolve(P,i);return P&&P.substr(P.lastIndexOf("/")).indexOf("(")===-1;};z.prototype._isMetadataPath=function(P){var i=false;if(P&&P.indexOf('/#')>-1){i=true;}return i;};z.prototype.isMetaModelPath=function(P){return P.indexOf("##")==0||P.indexOf("/##")>-1;};z.prototype._request=function(R,S,E,H,i,j){var k;if(this.bDestroyed){return{abort:function(){}};}var n=this;function D(G){return function(){if(n.aPendingRequestHandles){var I=n.aPendingRequestHandles.indexOf(k);if(I>-1){n.aPendingRequestHandles.splice(I,1);}}if(!(k&&k.bSuppressErrorHandlerCall)){G.apply(this,arguments);}};}k=q.request(R,D(S||q.defaultSuccess),D(E||q.defaultError),H,i,j);if(R.async!==false){this.aPendingRequestHandles.push(k);}return k;};z.prototype.destroy=function(){this.bDestroyed=true;M.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var i=this.aPendingRequestHandles.length-1;i>=0;i--){var R=this.aPendingRequestHandles[i];if(R&&R.abort){R.bSuppressErrorHandlerCall=true;R.abort();}}delete this.aPendingRequestHandles;}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent);}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent);}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata;}delete this.oMetadata;delete this.pMetadataLoaded;}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel;}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded;}};z.prototype.setDeferredBatchGroups=function(G){this.setDeferredGroups(G);};z.prototype.setDeferredGroups=function(G){var i=this;this.mDeferredGroups={};y(G,function(I,j){i.mDeferredGroups[j]=j;});};z.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups();};z.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups);};z.prototype.setChangeBatchGroups=function(G){y(G,function(E,i){i.groupId=i.batchGroupId;});this.setChangeGroups(G);};z.prototype.setChangeGroups=function(G){this.mChangeGroups=G;};z.prototype.getChangeBatchGroups=function(){return this.getChangeGroups();};z.prototype.getChangeGroups=function(){return this.mChangeGroups;};z.prototype.setMessageParser=function(P){if(!(P instanceof o)){L.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this;}P.setProcessor(this);this.oMessageParser=P;return this;};z.prototype._parseResponse=function(R,i,G,j){try{if(!this.oMessageParser){this.oMessageParser=new p(this.sServiceUrl,this.oMetadata);this.oMessageParser.setProcessor(this);}this.oMessageParser.parse(R,i,G,j);}catch(k){L.error("Error parsing OData messages: "+k);}};z.prototype.callAfterUpdate=function(i){this.aCallAfterUpdate.push(i);};z.prototype.getMetaModel=function(){var i=this;if(!this.oMetaModel){this.oMetaModel=new m(this.oMetadata,this.oAnnotations,{addAnnotationUrl:this.addAnnotationUrl.bind(this),annotationsLoadedPromise:this.pAnnotationsLoaded});this.oMetaModel.loaded().then(function(){i.bMetaModelLoaded=true;i.checkUpdate(false,false,null,true);},function(E){var j=E.message,D;if(!j&&E.xmlDoc&&E.xmlDoc.parseError){j=E.xmlDoc.parseError.reason;D=E.xmlDoc.parseError.srcText;}L.error("error in ODataMetaModel.loaded(): "+j,D,"sap.ui.model.odata.v2.ODataModel");});}return this.oMetaModel;};z.prototype.getOriginalProperty=function(P,i){return this._getObject(P,i,true);};z.prototype.getEntityByPath=function(P,i,E){var R=M.prototype.resolve.call(this,P,i);if(!R){return null;}var j=R.split("/"),k=null,n=[];while(j.length>0){var D=j.join("/"),G=this._getObject(D);if(x(G)){var K=this._getKey(G);if(K){k=G;break;}}n.unshift(j.pop());}if(k){E.propertyPath=n.join("/");E.key=K;return k;}return null;};z.prototype.resolveFromCache=function(P){if(!this.mPathCache){return undefined;}var S,E="",i,n,I;i=this.mPathCache[P]?this.mPathCache[P].canonicalPath:undefined;if(P&&i!==P){S=i||P;if(!i){I=S.lastIndexOf("/");E=S.substr(I);S=S.substr(0,I);}n=this.resolveFromCache(S);if(n&&n!==S){i=n+E;}}return i;};z.prototype.resolve=function(P,i,j){var R=M.prototype.resolve.call(this,P,i);if(R&&!this._isMetadataPath(R)&&j){var k=this.resolveFromCache(R);if(!k){k=this.oMetadata._calculateCanonicalPath(R);k=this.resolveFromCache(k)||k;}this._writePathCache(R,k);return k;}return R;};z.prototype.resolveDeep=function(P,i){var R=M.prototype.resolve.call(this,P,i);if(P&&!P.startsWith("/")){R=i?i.sDeepPath+'/'+P:R;}return R;};z.prototype.isLaundering=function(P,i){var R=this.resolve(P,i);return(R in this.mLaunderingState)&&this.mLaunderingState[R]>0;};z.prototype.increaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n];if(x(j)){this.increaseLaundering(P+"/"+n,j);}else{var T=P+"/"+n;if(!(T in this.mLaunderingState)){this.mLaunderingState[T]=0;}this.mLaunderingState[T]++;}}if(!(P in this.mLaunderingState)){this.mLaunderingState[P]=0;}this.mLaunderingState[P]++;};z.prototype.decreaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n],T=P+"/"+n;if(x(j)){this.decreaseLaundering(T,j);}else{if(T in this.mLaunderingState){this.mLaunderingState[T]--;if(this.mLaunderingState[T]===0){delete this.mLaunderingState[T];}}}}this.mLaunderingState[P]--;if(this.mLaunderingState[P]===0){delete this.mLaunderingState[P];}};z.prototype._getRefreshAfterChange=function(R,G){if(R===undefined&&!(G in this.mDeferredGroups)){return this.bRefreshAfterChange;}return R;};z.prototype.getMessagesByEntity=function(E,j){var k=E,n=[],P;function D(n){var G=[];for(var i=0;i<n.length;i++){if(!j||(j&&!n[i].persistent)){G.push(n[i]);}}return G;}if(!k.startsWith('/')){k='/'+k;}if(this.mMessages){for(P in this.mMessages){if(typeof k=="string"&&k.length>0&&P.startsWith(k)){n=n.concat(D(this.mMessages[P]));}}return n;}return null;};z.prototype._cacheSupported=function(i){var j=/\/~[\w\-]+~[A-Z0-9]?/;var k=[i];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}k=k.concat(this.sAnnotationURI);}k=k.filter(function(n){return n.indexOf("sap-context-token")===-1;});k=k.filter(function(n){return!j.test(n);});return k.length===0?true:false;};z.prototype._getAnnotationCacheKey=function(i){var j;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){j=i+"#annotations";}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}this.sAnnotationURI=this.sAnnotationURI.map(function(k){return k+"#annotations";});j=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):j+"_"+this.sAnnotationURI.join("_");}}return j;};return z;});
